/**
 * XPath for JSON with yate-like syntax
 *
 * @example
 *  jpath(json, '/.foo[.bar == "3" && !.gop || .soo].lop');
 *
 * @version 0.0.5
 * @author Artur Burtsev <artjock@gmail.com>
 * @link https://github.com/artjock/jpath
 *
 */(function(){var a=function(b,c){var d=a.split(c),e=a.exec(b,d.slice(0,2));for(var f=2,g=d.length;f<g&&e!==a.nf;f+=2)e=a.exec(e,d.slice(f,f+2));return e===a.nf?[]:a.util.isArray(e)?e:[e]};a.nf=undefined,typeof exports!="undefined"?exports=a:window.jpath=a,function(){a.extend=function(a,b){b||(b=a,a={});for(var c in b)a[c]=b[c];return a},a.util=a.extend({compact:function(a){var b=[];for(var c=0,d=a.length;c<d;c++)a[c]!==undefined&&b.push(a[c]);return b},isArray:function(a){return a instanceof Array}})}(),a.operators={"!":{name:"not",operand:1},"==":{name:"eq",operand:2},"!=":{name:"noteq",operand:2},"&&":{name:"and",operand:2},"||":{name:"or",operand:2}},function(){var b=/\.(?![^\[]+\])/,c=/([^\[]+)\[([^\]]+)\]/,d=/^\s*(\d+)\s*$/,e={result:[],placeholder:Array(100).join(" "),parsers:[/("|')([^\1]*?)\1/g,function(a,b,c,d){return e.result[d]=["string",c],e.placeholder.substr(0,a.length)},/(\.[^=\s!]*)/g,function(b,c,d){return c==="."?c="":(c=a.split(c),c.length===2&&(c=c[1])),e.result[d]=["node",c],e.placeholder.substr(0,b.length)},/(==|!=|!|\|\||&&)/g,function(a,b,c){return e.result[c]=["operator",b],e.placeholder.substr(0,a.length)}],parse:function(a){this.result=[];for(var b=0;b<this.parsers.length;b+=2)a=a.replace(this.parsers[b],this.parsers[b+1]);return this.result}},f=function(b){var c=a.operators;for(var d in c){var e=c[d];for(var f=0;f<b.length;f+=2)if(b[f]==="operator"&&b[f+1]===d)if(e.operand==1)b[f]=e.name,b[f+1]=b.splice(f+2,2);else if(e.operand==2){var g=[].concat(b.slice(f-2,f),b.slice(f+2,f+4));b[f]=e.name,b[f+1]=g,b.splice(f+2,2),b.splice(f-2,2)}}return b};a.split=function(g){var h,i=[],j=a.util.compact,k=g.split(b);if(k[0]===""||k[0]==="/")k=k.slice(1);while(h=k.shift()){var l=h.match(c);if(l){var m=l[2],n=m.match(d);n?tokens=["index",n[1]-0]:(tokens=e.parse(m),tokens=Array.prototype.concat.apply([],j(tokens)),tokens=f(tokens)),i.push("node",l[1]),i.push("predicate",tokens)}else i.push("node",h)}return i}}(),a.predicate=function(){},function(){var b=a.nf,c=a.util.isArray,d={node:function(a,e,f){if(e==="")return a;if(typeof a=="object"){if(c(a)){var g=[];for(var h=0,i=a.length;h<i;h++){var j=d.node(a[h],e,f);j!=b&&g.push(j)}return f?!!g.length:g}if(e in a)return f?!0:a[e]}return f?!1:b},index:function(a,d){return c(a)&&d<a.length?a[d]:b},string:function(a,b){return b},not:function(b,c){return!a.exec(b,c)},eq:function(b,c){return a.exec(b,c.slice(0,2))==a.exec(b,c.slice(2))},noteq:function(b,c){return a.exec(b,c.slice(0,2))==a.exec(b,c.slice(2))},or:function(b,c){return a.exec(b,c.slice(0,2),!0)||a.exec(b,c.slice(2),!0)},and:function(b,c){return a.exec(b,c.slice(0,2),!0)&&a.exec(b,c.slice(2),!0)}};a.exec=function(e,f,g){g=!!g;if(f[0]==="predicate"){if(c(e)&&f[1][0]!=="index"){var h=[];for(var i=0,j=e.length;i<j;i++){var k=a.exec(e[i],f);k!==b&&h.push(k)}return h}var k=a.exec(e,f[1],!0);return typeof k=="boolean"?k?e:b:k}return d[f[0]](e,f[1],g)}}()})();