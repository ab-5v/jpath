/**
 * XPath for JSON with yate-like syntax
 *
 * @example
 *  jpath(json, '/.foo[.bar == "3" && !.gop || .soo].lop');
 *
 * @version 0.0.2
 * @author Artur Burtsev <artjock@gmail.com>
 *
 */(function(){var a=function(b,c){var d=a.split(c),e=a.exec(b,d.slice(0,2));for(var f=2,g=d.length;f<g&&e!==a.nf;f+=2)e=a.exec(e,d.slice(f,f+2));return e};a.nf=undefined,typeof exports!="undefined"?exports=a:window.jpath=a,function(){a.extend=function(a,b){b||(b=a,a={});for(var c in b)a[c]=b[c];return a},a.util=a.extend({carry:function(a){var b=Array.prototype.slice,c=b.call(arguments,1);return function(){return a.apply(null,c.concat(b.apply(arguments)))}},compact:function(a){var b=[];for(var c=0,d=a.length;c<d;c++)a[c]!==undefined&&b.push(a[c]);return b},flatten:function(a){var b=[];for(var c=0,d=a.length;c<d;c++)b=b.concat(a[c]);return b},isArray:function(a){return a instanceof Array}})}(),a.operators={"!":{name:"not",operand:1},"==":{name:"eq",operand:2},"!=":{name:"noteq",operand:2},"&&":{name:"and",operand:2},"||":{name:"or",operand:2}},function(){var b=/\.(?![^\[]+\])/,c=/([^\[]+)\[([^\]]+)\]/,d={string:/("|')([^\1]*?)\1/g,node:/(\.[^=\s!]*)/g,index:/(\d+)/g,operator:/(==|!=|!|\|\||&&)/g},e=Array(100).join(" "),f=function(b,c,d,f,g){return typeof g!="number"&&(f=g,g=arguments[5]),c=="index"?f-=0:c=="node"&&(f=a.split(f),f.length===2&&(f=f[1])),b[g]=[c,f],e.substr(0,d.length)},g=function(b){var c=a.operators;for(var d in c){var e=c[d];for(var f=0;f<b.length;f+=2)if(b[f]==="operator"&&b[f+1]===d)if(e.operand==1)b[f]=e.name,b[f+1]=b.splice(f+2,2);else if(e.operand==2){var g=[].concat(b.slice(f-2,f),b.slice(f+2,f+4));b[f]=e.name,b[f+1]=g,b.splice(f+2,2),b.splice(f-2,2)}}return b};a.split=function(e){var h,i=[],j=a.util.carry,k=a.util.flatten,l=a.util.compact,m=e.split(b).slice(1);while(h=m.shift()){var n=h.match(c);if(n){i.push("node",n[1]);var o=[],p=n[2];for(var q in d)p=p.replace(d[q],j(f,o,q));o=k(l(o)),o=g(o),i.push("predicate"),i.push(o)}else i.push("node",h)}return i}}(),a.predicate=function(){},function(){var b=a.nf,c=a.util.isArray,d={node:function(a,c,d){return typeof a=="object"&&c in a?d?!0:a[c]:d?!1:b},index:function(a,d){return c(a)&&d<a.length?a[d]:b},string:function(a,b){return b},not:function(b,c){return!a.exec(b,c)},eq:function(b,c){return a.exec(b,c.slice(0,2))==a.exec(b,c.slice(2))},noteq:function(b,c){return a.exec(b,c.slice(0,2))==a.exec(b,c.slice(2))},or:function(b,c){return a.exec(b,c.slice(0,2),!0)||a.exec(b,c.slice(2),!0)},and:function(b,c){return a.exec(b,c.slice(0,2),!0)&&a.exec(b,c.slice(2),!0)}};a.exec=function(c,e,f){f=!!f;if(e[0]==="predicate"){var g=a.exec(c,e[1],!0);return typeof g=="boolean"?g?c:b:g}return d[e[0]](c,e[1],f)}}()})();