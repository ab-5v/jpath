/**
 * XPath for JSON with yate-like syntax
 *
 * @example
 *  jpath(json, '/.foo[.bar == "3" && !.gop || .soo].lop');
 *
 * @version 0.0.13
 * @author Artur Burtsev <artjock@gmail.com>
 * @link https://github.com/artjock/jpath
 *
 */(function(){var e=function(t,n){if(t===null||!n||typeof n!="string")return[];if(n===".")return[t];var r=e.split(n),i=e.exec(t,r.slice(0,2));for(var s=2,o=r.length;s<o&&i!==e.nf;s+=2)i=e.exec(i,r.slice(s,s+2));return i===e.nf?[]:e.util.isArray(i)?i:[i]};e.caching=!0,e.version="0.0.13",typeof exports!="undefined"?exports=e:window.jpath=e,function(){e.extend=function(e,t){t||(t=e,e={});for(var n in t)e[n]=t[n];return e};var t=Array.prototype.concat;e.util=e.extend({compact:function(e){var t=[];for(var n=0,r=e.length;n<r;n++)e[n]!==undefined&&t.push(e[n]);return t},flatten:function(e){return t.apply([],e)},isArray:function(e){return e instanceof Array}})}(),e.operators={"!":{name:"not",operand:1},"==":{name:"eq",operand:2},"!=":{name:"noteq",operand:2},"&&":{name:"and",operand:2},"||":{name:"or",operand:2}},function(){var t=/\.(?![^\[]+\])/,n=/^([^\[]+)?\[(\s*[^\]]+)\s*\]$/,r=/^(\d+)$/,i={result:[],placeholder:Array(100).join(" "),parsers:[/"([^"]*?)"/g,function(e,t,n){return i.result[n]=["string",t],i.placeholder.substr(0,e.length)},/(\.[^=\s!]*)/g,function(t,n,r){return n==="."?n="":(n=e.split(n),n.length===2&&(n=n[1])),i.result[r]=["node",n],i.placeholder.substr(0,t.length)},/(==|!=|!|\|\||&&)/g,function(e,t,n){return i.result[n]=["operator",t],i.placeholder.substr(0,e.length)}],parse:function(e){this.result=[];for(var t=0;t<this.parsers.length;t+=2)e=e.replace(this.parsers[t],this.parsers[t+1]);return this.result}},s=function(t){var n=e.operators;for(var r in n){var i=n[r];for(var s=0;s<t.length;s+=2)if(t[s]==="operator"&&t[s+1]===r)if(i.operand==1)t[s]=i.name,t[s+1]=t.splice(s+2,2);else if(i.operand==2){var o=[].concat(t.slice(s-2,s),t.slice(s+2,s+4));t[s]=i.name,t[s+1]=o,t.splice(s+2,2),t.splice(s-2,2)}}return t},o={};e.split=function(u){if(e.caching&&u in o)return o[u];var a,f=[],l=e.util.compact,c=e.util.flatten,h=u.split(t);if(h[0]===""||h[0]==="/")h=h.slice(1);while(a=h.shift()){var p=a.match(n);if(p){var d=p[2],v=d.match(r);v?tokens=["index",v[1]-0]:(tokens=i.parse(d),tokens=c(l(tokens)),tokens=s(tokens)),p[1]&&f.push("node",p[1]),f.push("predicate",tokens)}else f.push("node",a)}return e.caching&&(o[u]=f),f}}(),e.predicate=function(){},function(){var t=e.nf=undefined,n=e.util.isArray,r=function(e,t){var r=n(e),i=n(t);if(i&&!r){r=!0,i=!1;var s=t;t=e,e=s}if(r&&i){for(var o=e.length;o--;)for(var u=e.length;u--;)if(e[o]==t[u])return!0}else if(r&&!i){for(var o=e.length;o--;)if(e[o]==t)return!0}else if(e==t)return!0;return!1},i={node:function(e,r,s){if(r==="")return e;if(typeof e=="object"){if(n(e)){var o=[];for(var u=0,a=e.length;u<a;u++){var f=i.node(e[u],r,s);f!=t&&o.push(f)}return s?!!o.length:o}if(r==="*"){var o=[];for(var l in e)o.push(e[l]);return s?!!o.length:o}if(r in e){var c=e[r];return s?n(c)?!!c.length:!!c:e[r]}}return s?!1:t},index:function(e,r){return n(e)&&r<e.length?e[r]:t},string:function(e,t){return t},not:function(t,n){return!e.exec(t,n,!0)},eq:function(t,n){return r(e.exec(t,n.slice(0,2)),e.exec(t,n.slice(2)))},noteq:function(t,n){return!r(e.exec(t,n.slice(0,2)),e.exec(t,n.slice(2)))},or:function(t,n){return e.exec(t,n.slice(0,2),!0)||e.exec(t,n.slice(2),!0)},and:function(t,n){return e.exec(t,n.slice(0,2),!0)&&e.exec(t,n.slice(2),!0)}};e.exec=function(r,s,o){o=!!o;if(s[0]==="predicate"){if(n(r)&&s[1][0]!=="index"){var u=[];for(var a=0,f=r.length;a<f;a++){var l=e.exec(r[a],s);l!==t&&u.push(l)}return u}var l=e.exec(r,s[1],!0);return typeof l=="boolean"?l?r:t:l}return i[s[0]](r,s[1],o)}}()})();